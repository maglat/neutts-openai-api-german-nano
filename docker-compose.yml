services:
  neutts:
    build: .
    ports:
      - "8136:8000"
    environment:
      # Model + codec
      NEUTTS_MODEL_BASE: "neutts-nano-german"
      NEUTTS_BACKBONE_VARIANT: "q4"   # fp32 | q8 | q4
      NEUTTS_CODEC_REPO: "neuphonic/neucodec"
      NEUTTS_BACKBONE_DEVICE: "cpu"
      NEUTTS_CODEC_DEVICE: "cpu"

      # Voice samples inside container
      VOICE_SAMPLES_DIR: "/voices"

      # Hugging Face cache inside container
      HF_HOME: "/cache/huggingface"

      # Optional: token for private repos / higher rate limits
      # HUGGINGFACE_HUB_TOKEN: "${HUGGINGFACE_HUB_TOKEN}"

    volumes:
      # 1) Voice samples from your Ubuntu server (read-only!)
      - /srv/neutts/voices:/voices:rw

      # 2) Persist Hugging Face cache across restarts
      - hf-cache:/cache/huggingface

    healthcheck:
      test: ["CMD", "sh", "-c", "wget -qO- http://localhost:8000/health | grep -q ok"]
      interval: 10s
      timeout: 3s
      retries: 10

volumes:
  hf-cache:
